<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category Debug Test</title>
    <script type="module">
        // Import Supabase client
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'

        // You need to replace these with your actual Supabase credentials
        const SUPABASE_URL = 'YOUR_SUPABASE_URL_HERE'
        const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY_HERE'

        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

        async function testCategoryFetch() {
            console.log('üîç Testing category fetch...')
            
            try {
                const { data, error } = await supabase
                    .from('categories')
                    .select('*, subcategories(*)')
                    .order('display_order', { ascending: true })

                if (error) {
                    console.error('‚ùå ERROR:', error)
                    document.getElementById('result').innerHTML = `
                        <div style="color: red; padding: 20px; border: 2px solid red;">
                            <h2>‚ùå Error Fetching Categories</h2>
                            <p><strong>Message:</strong> ${error.message}</p>
                            <p><strong>Details:</strong> ${error.details || 'None'}</p>
                            <p><strong>Hint:</strong> ${error.hint || 'None'}</p>
                            <p><strong>Code:</strong> ${error.code || 'None'}</p>
                            ${error.message.includes('permission') || error.message.includes('RLS') ? 
                                '<p style="background:yellow;padding:10px;"><strong>‚ö†Ô∏è This looks like a Row Level Security (RLS) policy issue. You may need to disable RLS or create a policy that allows SELECT access.</strong></p>' : ''}
                        </div>
                    `
                    return
                }

                if (!data || data.length === 0) {
                    console.warn('‚ö†Ô∏è No categories found')
                    document.getElementById('result').innerHTML = `
                        <div style="color: orange; padding: 20px; border: 2px solid orange;">
                            <h2>‚ö†Ô∏è No Categories Found</h2>
                            <p>The database query succeeded but returned 0 categories.</p>
                            <p>You need to either:</p>
                            <ol>
                                <li>Run the seed_categories.sql script to populate categories</li>
                                <li>Use the "Seed Defaults" button in the Category Management page</li>
                                <li>Manually add categories through the Category Management page</li>
                            </ol>
                        </div>
                    `
                    return
                }

                console.log('‚úÖ Success!', data)
                let html = `
                    <div style="color: green; padding: 20px; border: 2px solid green;">
                        <h2>‚úÖ Success! Found ${data.length} categories</h2>
                        <ul>
                `
                data.forEach(cat => {
                    html += `<li><strong>${cat.name}</strong> (${cat.slug}) - ${cat.subcategories?.length || 0} subcategories</li>`
                })
                html += `</ul></div>`
                document.getElementById('result').innerHTML = html

            } catch (err) {
                console.error('‚ùå Unexpected error:', err)
                document.getElementById('result').innerHTML = `
                    <div style="color: red; padding: 20px; border: 2px solid red;">
                        <h2>‚ùå Unexpected Error</h2>
                        <p>${err.message}</p>
                    </div>
                `
            }
        }

        // Run test on page load
        window.addEventListener('DOMContentLoaded', testCategoryFetch)
    </script>
</head>
<body style="font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px;">
    <h1>üîç Category Database Test</h1>
    <p>This will test if categories can be fetched from your Supabase database.</p>
    <p><strong>‚ö†Ô∏è IMPORTANT:</strong> Edit this file and replace SUPABASE_URL and SUPABASE_ANON_KEY with your actual credentials from <code>.env</code></p>
    <div id="result">
        <p>‚è≥ Loading...</p>
    </div>
</body>
</html>
